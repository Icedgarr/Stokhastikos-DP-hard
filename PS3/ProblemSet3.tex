\documentclass[11pt, english]{article}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}



\usepackage{geometry}
\geometry{
	a4paper,
	left=20mm,
	top=30mm,
	right=20mm
}


\usepackage{listings}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm} 
\usepackage{mathrsfs}
\usepackage{mathabx}
\usepackage{graphicx}
\usepackage{eurosym}
\usepackage{subfigure}
\usepackage{dsfont}
\usepackage{bbm}

%\lstdefinestyle{myCustomMatlabStyle}{
%	language=Matlab,
%	numbers=left,
%	stepnumber=1,
%	numbersep=10pt,
%	tabsize=4,
%	showspaces=false,
%	showstringspaces=false
%}

\usepackage{graphicx} 
\usepackage{fancyvrb} 
\usepackage{listings} 
\usepackage{listings}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm} 
\usepackage{mathrsfs}
\usepackage{mathabx}
\usepackage{graphicx}
\usepackage{eurosym}
\usepackage{subfigure}
\usepackage{dsfont}
\usepackage{bbm}
\usepackage{inputenc}

\lstdefinestyle{myCustomMatlabStyle2}{% setup listings 
	language=R,% set programming language 
	basicstyle=\small,% basic font style 
	keywordstyle=\bfseries,% keyword style 
	commentstyle=\ttfamily\itshape,% comment style 
	numbers=left,% display line numbers on the left side 
	numberstyle=\scriptsize,% use small line numbers 
	numbersep=10pt,% space between line numbers and code 
	tabsize=3,% sizes of tabs 
	showstringspaces=false,% do not replace spaces in strings by a certain character 
	captionpos=b,% positioning of the caption below 
	breaklines=true,% automatic line breaking 
	escapeinside={(*}{*)},% escaping to LaTeX 
	fancyvrb=true,% verbatim code is typset by listings 
	extendedchars=false,% prohibit extended chars (chars of codes 128--255) 
	literate={"}{{\texttt{"}}}1{<-}{{$\leftarrow$}}1{<<-}{{$\twoheadleftarrow$}}1 
	{~}{{$\sim$}}1{<=}{{$\le$}}1{>=}{{$\ge$}}1{!=}{{$\neq$}}1{^}{{$^\wedge$}}1,% item to replace, text, length of chars 
	alsoletter={.<-},% becomes a letter 
	alsoother={$},% becomes other 
	otherkeywords={!=, ~, $, *, \&, \%/\%, \%*\%, \%\%, <-, <<-, /},% other keywords 
	deletekeywords={c}% remove keywords 
}

\newcommand{\grafico}[5]{
	\begin{figure}
		[h!tbp]
		\centering
		\includegraphics[scale=#2, angle=#3]{#1}
		%\captionsetup{width=13cm}
		\caption{#4\label{#5}}
	\end{figure}
}

\newcommand{\su}[2]{\sum\limits_{#1}^{#2}}

\setlength{\parindent}{0pt}
\begin{document}
\title{Stochastic Models and Optimization: Problem Set 3}
\author{Roger Garriga Calleja, José Fernando Moreno Gutiérrez, David Rosenfeld, Katrina Walker}
\date{\today}
\begin{document}
\maketitle
\section*{Q1. Inventory control with forecasts}
\textbf{(a): Single period}\\
\textbf{Primitives}
$D$: Demand, which is a random variable \\ $D =     \left\{ \begin{array}{rcl}
         P_L & \mbox{ with probability q}\\ 
         P_S  & \mbox{with probability 1 - q}
                \end{array}\right.$\\
$p$: Sale price per unit\\ $c$: Ordering cost per unit\\$s$: Salvage value per unit\\ $b = p - c$: Backorder cost per unit\\ $h = c - s$: Inventory holding cost per unit\\ $Q$: Inventory decision.\\
\\
The profit for this problem can be written as:\\
$\pi(Q) = E[p.min\{D, Q\} - c.Q + s(Q - D)^+]$\\
$\pi(Q) = pE[D] - (p - c)E[(D - Q)^+] + (c - s)E[(Q - D)^+]$\\
$\pi(Q) = pE[D] - bE[(D - Q)^+] - hE[(Q - D)^+]$\\
\\
We then expand the formula to account for the expectation of demand D which takes value $P_L$ with probability $q$:\\
$$\pi(Q) = pE[D] - b[q.E_{P_L}[(D - Q)^+] + (1 -q).E_{P_S}[(D - Q)^+]] - h[qE_{P_L}[(Q - D)^+] + (1 - q)E_{P_S}[(Q - D)^+]]$$
\\
We take the derivative of the profit with respect to quantity in order to minimise, and set it equal to zero (with $P_L$ and $P_S$ the probability distributions in the large and small demand cases respectively):\\
$$\pi'(Q^*) = -b[qP_L(D > Q^*) + (1 -q)P_S(D > Q^*)] + h[qP_L(Q^* > D) + (1 - q)P_S(Q^* > D) = 0$$
\\
$$-bq(1 -P_L(D \leq Q^*) - b(1 -q)(1 -P_S(D \leq Q^*)) + hqP_L(D \leq Q^*) + h(1 - q)P_S(D \leq Q^*) = 0$$
We can then obtain that the optimal decision $Q^*$ satisfies:
$$qP_L(D \leq Q^*) + (1 - q)P_S(D \leq Q^*) = \frac{b}{b + h}$$


\textbf{(b) Multi-period problem}\\
\textbf{Primitives}\\
$x_k$: Inventory level at period k \\$u_k$: Decision variable over the number of units to order.\\ $w_k$: Demand at period k.\\ $y_{k+1} = \xi$ where $\xi$ takes the value "large demand" with probability q:\\ $\xi_k =     \left\{ \begin{array}{rcl}
         L & \mbox{ with probability q}\\ 
         S  & \mbox{with probability 1 - q}
                \end{array}\right.$\\
$c$: ordering cost per unit\\ $p$: Sale price per unit\\ $s$: Salvage value\\ $b = p - c$: Backorder cost per unit\\ $h = c - s$: Inventory holding cost per unit\\
\\
\textbf{Dynamics:}\\
$x_{k+1} = x_k + u_k - w_k$\\ $y_{k+1} = \xi_k$\\ $g_N(x_N) = -s(x_N)$\\ $g_k(x_k, u_k, w_k) = cu_k - pw_k + b max\{w_k - x_k - u_k, 0\} + h max\{x_k + u_k - w_k\}$\\
\\
\textbf{DP algorithm}:
$J_N(x_N) = -s(x_N)$\\
$J_k(x_k) = \min_{u_k \geq 0}E_{w_k, \xi_k}[g_k(x_k, u_k, w_k) + J_{k+1}(x_k, u_k, w_k)]$\\
\\
We can introduce the variable $z_k = x_k + u_k$, and rewrite our DP equation as follows:\\
$$J_k(x_k) = \min_{z_k \geq x_k}[G_k(z_k)] - cx_k$$
where $G_k(z_k) = cz_k + bE[max\{0, w_k - z_k\}] + hE[max\{0, z_k - w_k\}] + E[J_{k+1}(z_k - w_k)]$\\
\\
Once again we can expand this expression to take into account the two different values of $\xi$ for large and small demand:\\
$G_k(z_k) = cz_k + bqE[max\{0, w_k - z_k\} | \xi = L] + b(1 -q)E[max\{0, w_k - z_k\} | \xi = S] + hqE[max\{0, z_k - w_k\} | \xi = L] + h(1 -q)E[max\{0, z_k - w_k\} | \xi = S] + E[J_{k+1}(z_k - w_k)]$\\
\\
$G_k(z_k)$ is a convex function for all k, and there will be a solution $S_k$ which minimises $G(z)$ such that the optimal ordering policy becomes:\\
$u_k^* = \mu_k^* = S_k - x_k$ if $S_k > x_k$, and 0 otherwise.
<<<<<<< HEAD
\section{Q3. Inventory Pooling}
=======


\section*{Q2. Inventory Pooling}
>>>>>>> 1e2a1b310ef173326ffde55521f5e49c104e2994
\textbf{Primitives}\\ D = demands \\ Q = quantity ordered \\ P = price \\ h =
inventory costs =  c-s \\ b = backholding costs = p-c \\ \\ First we will show that $Q_p^* = \sqrt{n}Q^* + \mu(n- \sqrt{n})$%
\begin{align*} 
G(Q) = hE[(Q-D)]^+bE[(D-Q)]^+ \\ G'(Q^*)= hP(D \leq Q^*) - b(1-P[(D\leq Q^*)]) =
0 \\ P(D \leq Q^*) = \frac{b}{h+b} \\ 
\end{align*}
Now, for the pooling we would obtain the same:
\begin{align*} 
P (\sum_{L= 1}^n D_i \leq Q_p^*) = &  \frac{b}{b+R} \\
\end{align*}
Since  this $\sum_{i = 1}^nD_i = \sqrt{n}D_i+\mu(n-\sqrt{n})$, 
\begin{align*}	
P(\sqrt{n}D_1 + \mu(n - \sqrt{n})\leq Q_p^*) = \frac{b}{b+R}  \Longleftrightarrow P(D_1 \leq
\frac{1}{\sqrt{n}}(Q_p^*- \mu(n-\sqrt{n})))= \frac{b}{b + h} \end{align*} 
which implies that $\frac{1}{\sqrt{n}}(Q_p^*- \mu(n-\sqrt{n})))$ = $Q^*$. Thus, $Q^*_P = \sqrt{n}Q^*+\mu(n-\sqrt{n})$.  Next, we will apply the hint to prove the desired result:
\begin{align*} nG(Q^*) &=
n[hE[(Q^*-D)^+]+bE[(D-Q^*)^+]]\\ G(Q^*_p) & =
[hE[(Q^*_p-\sum_{i=1}^nD_i)^+]+bE[(\sum_{i=1}^nD_i-Q^*_p)^+]]\\ 
\end{align*} 
Since $\sum_{i = 1}^nD_i = \sqrt{n}D_i+\mu(n-\sqrt{n})$ and $Q^*_P = \sqrt{n}Q^*+\mu(n-\sqrt{n})$, we can show that:\\
\begin{align*} 
G(Q^*_P) & =  [hE[(\sqrt{n}Q^*+\mu(n-\sqrt{n})-\sqrt{n}D_i-\mu(n-\sqrt{n}))^+] \\
+& b E[\sqrt{n}D_i+\mu(n-\sqrt{n})-\sqrt{n}Q^*+\mu(n-\sqrt{n})^+]]\\
& = \sqrt{n}hE[(Q^*-D_i)^+] + \sqrt{n} \ b E[(D_i-Q^*)^+] = \frac{nG(Q^*)}{\sqrt{n}}\\ 
\end{align*} 
Q.E.D.\\

\section*{Q3. Asset Selling with Maintenance Cost}

\textbf{Primitives:}\\

$w_k$: Offer received in the period k.\\

$x_k$: Highest offer received up to period k.\\

$u_k=\left\{\begin{array}{ll}
1 & \text{if accept the offer }x_k\\
0 & \text{otherwise}
\end{array}\right.$\\

$c$: Maintenance cost.\\

\textbf{Dynamics:}\\

$x_{k + 1}=\left\{\begin{array}{ll}
\max\{w_k, x_k\} & \text{if } u_k = 0\\
T & \text{if } x_k = T \text{ or } u_k = 1
\end{array}\right.$\\

\textbf{Reward:}\\

$G_N(x_N) = \left\{\begin{array}{ll}
0 & \text{if } x_N = T\\
x_N & \text{otherwise}
\end{array}\right.$\\

$G_k(x_k)=\left\{\begin{array}{ll}
-c & \text{if } u_k = 0 \text{ and } x_k  \neq T\\
x_k & \text{if } u_k = 1 \\
0 & \text{if } x_k = T
\end{array}\right.$\\

\textbf{DP-Algorithm:}\\

\begin{equation*}
J_N(x_N) = \left\{\begin{array}{ll}
0 & \text{if } x_N = T\\
x_N & \text{otherwise}
\end{array}\right.
\end{equation*}

\begin{align*}
J_k(x_k) =& \left\{\begin{array}{ll}
\max\limits_{u_k \in \mu_k} \left\{x_k, \mathbb{E}_{w_k} \left[J_{k+1} (x_{k+1})\right] - c \right\} & \text{if } x_k \neq T\\
0 \text{ otherwise} & 
\end{array}\right.  \\
= & \left\{\begin{array}{ll}
\max\limits_{u_k \in \mu_k} \left\{x_k, \mathbb{E}_{w_k} \left[J_{k+1} (\max\{w_k, x_k\})\right] - c \right\} & \text{if } x_k \neq T\\
0 \text{ otherwise} & 
\end{array}\right.
\end{align*}\\

Where $\mathbb{E}_{w_k} \left[J_{k+1} (\max\{w_k, x_k\})\right] = \su{j = 1}{n} p_j\max (x, w_j)$ \\

Thus the optimal policy is given by

\begin{equation*}
\mu^*(x) = \left\{\begin{array}{ll}
1 & \text{if } x \geq  \su{j = 1}{n} p_j\max (x, w_j) - c\\
0 & \text{otherwise}
\end{array}\right.
\end{equation*}

This optimal policy implies that the actual reward should be greater or equal to the expected reward if we don't accept the maximum offer up to $k$. Thus we can define the optimal policy as follows:

\begin{equation*}
\mu^*(x) = \left\{\begin{array}{ll}
1 & \text{if } c \geq  \su{j = 1}{n} p_j\max (x, w_j) - x\\
0 & \text{otherwise}
\end{array}\right.
\end{equation*}

where $h(x) = \su{j = 1}{n} p_j\max (x, w_j) - x$ is a nonincreasing function. Therefore, we obtain that if the cost is greater than the difference between the expected value of future offers and the maximum offer we have received, we decide to sell. Thus, we will have less incentives to sell as time goes by. Each period it is more probable that our maintenance cost will will be equal to our reward improvement.\\

\section*{Q4 An Investment Problem}

\underline{Primitives:\\} 

$x_k$: wealth at the beginning of period $k$.\\
$u_k$: amount invested.\\
$w_k$: outcome (return).\\
$w_k=\left\{\begin{array}{ll}
2u_k & \text{w.p. }p\\
0 & \text{w.p. }1-p
\end{array}\right.$\\
where $\frac{1}{2}<p<1$.\\

\underline{Constrains:\\}

$u_k\geq 0$, \\
$u_k\leq x_k$.\\

\underline{Dynamics:\\}

$x_{k+1}=x_k-u_k+w_k$, \\

\underline{Cost:\\}

$g_N(x_N)=x_N$\\
$g_k(x_k,u_k,w_k)=0$. \\

\underline{DP algorithm:\\}

To simplify th
$J_N(x_N)=\log(x_N)$. \\
$J_k(x_k)=\underset{u_k\in \mathcal{U}_k}{\max}\mathbb{E}_{w_k}\left[J_{k+1}(x_k-u_k+w_k)\right]$.\\
We will first prove that $J_k(x_k)=A_k+\log(x_k)$ by induction (where $\log$ is the logarithm in base $e$).

\begin{align}
J_{N-1}(x_{N-1})&=\underset{u_{n-1}}{\max\ }\mathbb{E}_{w_{N-1}}\left[\log(x_{N-1}-u_{N-1}+w_{N-1})\right]=\\
&=\underset{u_{N-1}}{\max\ }\mathbb{E}_{w_{N-1}}[\log(x_{N-1}-u_{N-1}+w_{N-1})]=\\
&=\underset{u_{N-1}}{\max\ }\left[p\log(x_{N-1}+u_{N-1})+(1-p)\log(x_{N-1}-u_{N-1})\right].
\end{align}
Now, we derive and apply FOC to find the maximum,
\begin{align}
\frac{p}{x_{N-1}+u_{N-1}}-\frac{1-p}{x_{N-1}-u_{N-1}}=0
\end{align}
\begin{align}
px_{N-1}-pu_{N-1}^*=x_{N-1}+u_{N-1}^*-px_{N-1}-pu_{N-1}^*,
\end{align}
solving we obtain $u_{N-1}^*=(2p-1)x_{N-1}$, which makes sense, because $2p-1$ is between 0 and 1 for $\frac{1}{2}<p<1$. Plugging into the expression of $J_{N-1}(x_{N-1})$
\begin{align}
J_{N-1}(x_{N-1})&=p\log(x_{N-1}+(2p-1)x_{N-1})+(1-p)\log(x_{N-1}-(2p-1)x_{N-1})=\\
&=p\log(2px_{N-1})+(1-p)\log(2(1-p)x_{N-1})=\\
&=p\log(2p)+p\log(x_{N-1})+(1-p)\log(2(1-p))+(1-p)\log(x_{N-1}=\\
&=p\log(2p)+(1-p)\log(2(1-p))+\log(x_{N-1}).
\end{align}
So, for $N-1$ we have $A_{N-1}=p\log(2p)+(1-p)\log(2(1-p))$. Now, suppose $J_{k+1}(x_{k1})=A_{k+1}+\log(x_{k+1})$ let's prove it for $k$:
\begin{align}
J_{k}(x_{k})&=\underset{u_{k}}{\max\ }\mathbb{E}_{w_{k}}\left[A_{k+1}+\log(x_{k+1})\right]=\\
&=\underset{u_{k}}{\max\ }\mathbb{E}_{w_{k}}\left[A_{k+1}+\log(x_{k}-u_{k}+w_{k})\right]=\\
&=\underset{u_{k}}{\max\ }\left[A_{k+1}+ p\log(x_{k}+u_{k})+(1-p)\log(x_{k}-u_{k})\right].
\end{align} 
Applying first order conditions we would obtain the same equation as before ($A_{k+1}$ does not depend on $u_k$), so $u_k=(2p-1)x_k$. Plugging in the $J_k(x_k)$ we obtain the same way as before
\begin{align}
J_{k}(x_{k})&=A_{k+1}+p\log(2p)+(1-p)\log(2(1-p))+\log(x_{k}).
\end{align}
So, $J_k(x_k)=A_k+\log(x_k)$, where $A_k=A_{k+1}+p\log(2p)+(1-p)\log(2(1-p))$. So, the policy will be to invest $(2p-1)x_k$ of wealth each period $k$.

\section*{Q5 A Scheduling Problem}

\textbf{(a)}\\

Let $i$ and $j$ be the $k$th and $(k + 1)$st questions
in an optimal ordered list:

\begin{equation*}
L = (i_0, \cdots , i_{k-1}, i, j, i_{k+2}, \cdots, i_{N-1})
\end{equation*}

Also consider the list with $i$ and $j$ interchanged:

\begin{equation*}
L' = (i_0, \cdots , i_{k-1}, j, i, i_{k+2}, \cdots, i_{N-1})
\end{equation*}

Then define $R$ as the reward. Thus

\begin{align*}
\mathbb{E}(R(L)) =& \mathbb{E} \left[R(i_0, \cdots, i_{k-1})\right] + p_{i_0} \cdots p_{i_{k-1}} \left(p_i R_i - (1-p_i)F_i + p_ip_jR_j - p_i(1-p_j)F_j\right)\\
&+ p_{i_0} \cdots p_{i_{k-1}} p_i p_j \mathbb{E} \left[R(i_{k+2}, \cdots, i_{N-1})\right] \\
\mathbb{E}(R(L')) =& \mathbb{E} \left[R(i_0, \cdots, i_{k-1})\right] + p_{i_0} \cdots p_{i_{k-1}} \left(p_j R_j - (1-p_j)F_j + p_jp_iR_i - p_j(1-p_i)F_i\right)\\
&+ p_{i_0} \cdots p_{i_{k-1}} p_j p_i \mathbb{E} \left[R(i_{k+2}, \cdots, i_{N-1})\right]
\end{align*}

$L$ optimal implies

\begin{align*}
\mathbb{E}(R(L)) &\geq \mathbb{E}(R(L'))\\
p_i R_i - (1-p_i)F_i + p_ip_jR_j - p_i(1-p_j)F_j &\geq p_j R_j - (1-p_j)F_j + p_jp_iR_i - p_j(1-p_i)F_i \\
p_i R_i - (1-p_i)F_i - p_jp_iR_i + p_j(1-p_i)F_i &\geq p_j R_j - (1-p_j)F_j - p_ip_jR_j + p_i(1-p_j)F_j\\
R_i (p_i - p_jp_i) - F_i(1-p_i -p_j(1-p_i)) &\geq R_j(p_j - p_ip_j) - F_j(1-p_j-p_i(1-p_j)) \\
R_i p_i(1-p_j) - F_i(1-p_i)(1-p_j) &\geq R_jp_j(1-p_i) - F_j(1-p_j)(1-p_i) \\
(1-p_j)(R_ip_i - F_i(1-p_i)) &\geq (1-p_i)(R_jp_j - F_j(1-p_j)) \\
\dfrac{R_ip_i - F_i(1-p_i)}{1-p_i} &\geq \dfrac{R_jp_j - F_j(1-p_j)}{1-p_j} \hspace{1cm}\text{ Q.E.D}
\end{align*}

\textbf{(b)}\\

\textbf{Primitives:}\\

$x_k$: Reward up to period k.\\

$u_k=\left\{\begin{array}{ll}
1 & \text{to answer}\\
0 & \text{otherwise}
\end{array}\right.$\\

$w_k=\left\{\begin{array}{ll}
Rk & \text{w.p } p_k\\
-F_k & \text{w.p } (1-p_k)
\end{array}\right.$\\

\textbf{Dynamics:}\\

$x_{k + 1}=\left\{\begin{array}{ll}
x_k + u_k w_k & \text{if } x_k \neq R\\
T & \text{if } x_k = T \text{ or } u_k = 0
\end{array}\right.$\\

\textbf{Reward:}\\

$G_N(x_N) = 0$\\

$G_k(x_k)=\left\{\begin{array}{ll}
w_k & \text{if } u_k = 1 \text{ and } x_k  \neq T\\
0 & \text{otherwise }
\end{array}\right.$\\

\textbf{DP-Algorithm:}\\

\begin{equation*}
J_N(x_N) = 0
\end{equation*}

\begin{align*}
J_k(x_k) =& \max\limits_{u_k} \mathbb{E}_{w_k} \left[g(x_k, u_k, w_k) + J_{k+1}(x_{k+1})\right] \\
= & \max\left\{w_k + J_{k+1}(x_k + w_k), 0 \right\}
\end{align*}\\

So we have that
\begin{align*}
J_{N-1}(x_{N-1}) =& \max\left\{\mathbb{E}_{w_{N-1}} \left[w_{N-1}\right], 0 \right\} \\
= & \max\left\{R_{N-1} p_{N-1} - F_{N-1} (1 - p_{N-1}), 0 \right\}
\end{align*}\\

Then the win and lose does not depend on $x_{N-1}$. It will depend on the optimal list $L$. Thus

\begin{equation*}
J_{k}(x_k) = \max\left\{R_{k} p_{k} - F_{k} (1 - p_{k}) + J_{k+1} (L), 0 \right\}
\end{equation*}

Therefore, $R_{k} p_{k} - F_{k} (1 - p_{k}) + J_{k+1} (L)$ does not depend on $x_k$. It depends in fact on $u_k$ which is the decision of continuing to playing or not. So the optimal policy since the beginning is to look if $R_{k} p_{k} - F_{k} (1 - p_{k}) + J_{k+1} (L) > 0$.


\end{document}
